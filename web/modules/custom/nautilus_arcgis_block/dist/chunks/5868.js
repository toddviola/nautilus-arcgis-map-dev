"use strict";(self.webpackChunkarcgis_map_test=self.webpackChunkarcgis_map_test||[]).push([[5868,285],{81195:(e,t,a)=>{a.d(t,{v:()=>o});var r=a(37440);function o(e){e?.writtenProperties&&e.writtenProperties.forEach((({target:e,propName:t,newOrigin:a})=>{(0,r.H)(e)&&a&&e.originOf(t)!==a&&e.updateOrigin(t,a)}))}},37440:(e,t,a)=>{function r(e){return e&&"getAtOrigin"in e&&"originOf"in e}a.d(t,{H:()=>r})},30285:(e,t,a)=>{a.d(t,{addOrUpdateResources:()=>i,bg:()=>f,cL:()=>d,fetchResources:()=>s,removeAllResources:()=>c,removeResource:()=>l});var r=a(1968),o=a(51819),n=a(75899);async function s(e,t={},a){await e.load(a);const r=(0,n.fj)(e.itemUrl,"resources"),{start:o=1,num:s=10,sortOrder:i="asc",sortField:l="resource"}=t,c={query:{start:o,num:s,sortOrder:i,sortField:l,token:e.apiKey},signal:a?.signal},p=await e.portal.request(r,c);return{total:p.total,nextStart:p.nextStart,resources:p.resources.map((({created:t,size:a,resource:r})=>({created:new Date(t),size:a,resource:e.resourceFromPath(r)})))}}async function i(e,t,a,r){const s=new Map;for(const{resource:e,content:r,compress:n,access:i}of t){if(!e.hasPath())throw new o.A(`portal-item-resource-${a}:invalid-path`,"Resource does not have a valid path");const[t,l]=p(e.path),c=`${t}/${n??""}/${i??""}`;s.has(c)||s.set(c,{prefix:t,compress:n,access:i,files:[]}),s.get(c).files.push({fileName:l,content:r})}await e.load(r);const i=(0,n.fj)(e.userItemUrl,"add"===a?"addResources":"updateResources");for(const{prefix:t,compress:a,access:o,files:n}of s.values()){const s=25;for(let l=0;l<n.length;l+=s){const c=n.slice(l,l+s),p=new FormData;t&&"."!==t&&p.append("resourcesPrefix",t),a&&p.append("compress","true"),o&&p.append("access",o);let u=0;for(const{fileName:e,content:t}of c)p.append("file"+ ++u,t,e);p.append("f","json"),await e.portal.request(i,{method:"post",body:p,signal:r?.signal})}}}async function l(e,t,a){if(!t.hasPath())throw new o.A("portal-item-resources-remove:invalid-path","Resource does not have a valid path");await e.load(a);const r=(0,n.fj)(e.userItemUrl,"removeResources");await e.portal.request(r,{method:"post",query:{resource:t.path},signal:a?.signal}),t.portalItem=null}async function c(e,t){await e.load(t);const a=(0,n.fj)(e.userItemUrl,"removeResources");return e.portal.request(a,{method:"post",query:{deleteAll:!0},signal:t?.signal})}function p(e){const t=e.lastIndexOf("/");return-1===t?[".",e]:[e.slice(0,t),e.slice(t+1)]}function u(e){const[t,a]=function(e){const t=(0,n.Zo)(e);return null==t?[e,""]:[e.slice(0,e.length-t.length-1),`.${t}`]}(e),[r,o]=p(t);return[r,o,a]}async function d(e){return"blob"===e.type?e.blob:"json"===e.type?new Blob([e.jsonString],{type:"application/json"}):(await(0,r.A)(e.url,{responseType:"blob"})).data}function f(e,t){if(!e.hasPath())return null;const[a,,r]=u(e.path);return e.portalItem.resourceFromPath((0,n.fj)(a,t+r))}},49695:(e,t,a)=>{a.d(t,{S:()=>l,r:()=>i});var r=a(51819),o=a(66011),n=a(39550),s=a(30285);async function i(e,t,a){const r=await c(e,t,a);await p(r,t,a)}async function l(e,t,a,r,o){const n=await c(a,r,o);await e.update({data:t}),await p(n,r,o)}async function c(e,t,i){if(!t?.resources)return;const l=t.portalItem===e.portalItem?new Set(e.paths):new Set;e.paths.length=0,e.portalItem=t.portalItem;const c=new Set(t.resources.toKeep.map((e=>e.resource.path))),p=new Set,u=[];c.forEach((t=>{l.delete(t),e.paths.push(t)}));const d=[],f=[],m=[];for(const a of t.resources.toUpdate)if(l.delete(a.resource.path),c.has(a.resource.path)||p.has(a.resource.path)){const{resource:t,content:r,finish:o}=a,i=(0,s.bg)(t,(0,n.lk)());e.paths.push(i.path),d.push({resource:i,content:await(0,s.cL)(r),compress:a.compress}),o&&m.push((()=>o(i)))}else{e.paths.push(a.resource.path),f.push({resource:a.resource,content:await(0,s.cL)(a.content),compress:a.compress});const t=a.finish;t&&m.push((()=>t(a.resource))),p.add(a.resource.path)}for(const a of t.resources.toAdd)if(e.paths.push(a.resource.path),l.has(a.resource.path))l.delete(a.resource.path);else{d.push({resource:a.resource,content:await(0,s.cL)(a.content),compress:a.compress});const e=a.finish;e&&m.push((()=>e(a.resource)))}if(d.length||f.length){const{addOrUpdateResources:e}=await Promise.resolve().then(a.bind(a,30285));await e(t.portalItem,d,"add",i),await e(t.portalItem,f,"update",i)}if(m.forEach((e=>e())),0===u.length)return l;const w=await(0,o.Ol)(u);if((0,o.Te)(i),w.length>0)throw new r.A("save:resources","Failed to save one or more resources",{errors:w});return l}async function p(e,t,a){if(!e||!t.portalItem)return;const r=[];for(const o of e){const e=t.portalItem.resourceFromPath(o);r.push(e.portalItem.removeResource(e,a))}await(0,o.Lx)(r)}},22493:(e,t,a)=>{a.d(t,{X:()=>s});var r=a(30423),o=a(51819),n=a(22173);function s(e){if(r.A.apiKey&&(0,n.Q)(e.portal.url))throw new o.A("save-api-key-utils:api-key-not-supported",`Saving is not supported on ${e.portal.url} when using an api key`)}},5064:(e,t,a)=>{a.d(t,{c:()=>s,d:()=>o});var r=a(51819);async function o(e){const t=[];for(const a of e.allLayers)if("beforeSave"in a&&"function"==typeof a.beforeSave){const e=a.beforeSave();e&&t.push(e)}await Promise.allSettled(t)}const n=new Set(["layer:unsupported","property:unsupported","symbol:unsupported","symbol-layer:unsupported","url:unsupported"]);function s(e,t,a){let o=(e.messages??[]).filter((({type:e})=>"error"===e)).map((({name:e,message:t,details:a})=>new r.A(e,t,a)));if(e.blockedRelativeUrls&&(o=o.concat(e.blockedRelativeUrls.map((e=>new r.A("url:unsupported",`Relative url '${e}' is not supported`))))),a){const{ignoreUnsupported:e,supplementalUnsupportedErrors:t=[],requiredPropertyChecksDisabled:r}=a;e&&(o=o.filter((({name:e})=>!(n.has(e)||t.includes(e))))),r&&(o=o.filter((e=>"web-document-write:property-required"!==e.name)))}if(o.length>0)throw new r.A(t.errorName,"Failed to save due to unsupported or invalid content. See 'details.errors' for more detailed information",{errors:o})}},35868:(e,t,a)=>{a.d(t,{save:()=>R,saveAs:()=>I});var r=a(51819),o=a(53991),n=a(25237),s=a(75899),i=a(81195),l=a(54413),c=a(85204),p=a(93548),u=a(8397),d=a(92328),f=a(23641),m=a(95357),w=a(21889),h=a(5510),y=a(25181),g=a(82709),v=a(87907),b=a(49695),_=a(22493),A=a(5064);const O=["NatGeo_World_Map","Ocean_Basemap","USA_Topo_Maps","World_Imagery","World_Street_Map","World_Terrain_Base","World_Topo_Map","World_Hillshade","Canvas/World_Light_Gray_Base","Canvas/World_Light_Gray_Reference","Canvas/World_Dark_Gray_Base","Canvas/World_Dark_Gray_Reference","Ocean/World_Ocean_Base","Ocean/World_Ocean_Reference","Reference/World_Boundaries_and_Places","Reference/World_Reference_Overlay","Reference/World_Transportation"].map((e=>e.toLowerCase()));async function R(e,t,a){a??={},function(e,t){if(!t.portalItem)throw new r.A(`${e.name}:portal-item-not-set`,"Portal item to save to has not been set on the WebMap");(0,_.X)(t.portalItem),P(e,t.portalItem)}(e,t),await(0,n.C_)((()=>!t.updatingFromView)),await t.load(),await M(t),await(0,A.d)(t),await S(e,t);const o=t.portalItem,s=(0,w.m)(o,"web-map",!0),i=t.write({},s);return await Promise.all(s.resources.pendingOperations),(0,A.c)(s,{errorName:`${e.name}:save`},a),await W(t,o),await async function(e,t,a,r,o){await a.update({data:r}),B(e,t,a,r,o)}(e,t,o,i,s),await Promise.all([t.updateItemThumbnail(),(0,b.r)(t.resourceReferences,s)]),o}async function I(e,t,a,o){o??={};const i=function(e,t){let a=m.default.from(t);return a.id&&(a=a.clone(),a.id=null),a.type||(a.type=e.itemType),a.portal||(a.portal=f.A.getDefault()),(0,_.X)(a),P(e,a),a}(e,a);await(0,n.C_)((()=>!t.updatingFromView)),await t.load(),function(e,t){const a=t.allLayers.filter((e=>"unsupported"===e.type&&"KnowledgeGraphLayer"===e.resourceInfo?.layerType));if(a.length)throw new r.A(`${e.name}:save-as-invalid-configuration`,`Failed to save a copy of ${e.name} to prevent persisting invalid configuration. See 'details.layers'`,{layers:a.toArray()})}(e,t),await M(t),await(0,A.d)(t),await S(e,t);const l=(0,w.m)(i,"web-map",!0),c=t.write({},l);await Promise.all(l.resources.pendingOperations),(0,A.c)(l,{errorName:`${e.name}:save`},o),await async function(e,t){(0,h.OM)(t,k),(0,h.OM)(t,x),(0,h.OM)(t,h.mm.METADATA),(0,h.OM)(t,G),(0,h.OM)(t,F),(0,h.OM)(t,E),(0,h.OM)(t,U),(0,h.OM)(t,D),await W(e,t)}(t,i);const p=t.getThumbnailState();return await async function(e,t,a,o,n,i){const l=t.portalItem,c={item:l,authenticated:!(!l?.id||!l.portal.user)},p=a.portal;await p.signIn();const{copyAllowed:u,itemReloaded:d}=await async function(e,t){const{item:a,authenticated:r}=e;return a?.id&&a.typeKeywords?.includes("useOnly")?a.portal.portalHostname!==t.portalHostname?{copyAllowed:!1,itemReloaded:!1}:(r||await a.reload(),{copyAllowed:"admin"===a.itemControl||"update"===a.itemControl,itemReloaded:!0}):{copyAllowed:!0,itemReloaded:!1}}(c,p);if(c.authenticated||=d,!u)throw new r.A(`${e.name}:save-as-copy-not-allowed`,"Owner of this map does not allow others to save a copy");const f=await async function(e,t,a,r){const o=e.portal,{item:n}=t,{folder:i,copyAllResources:l}=r;let c=!1;if(l&&n?.id&&(0,s.b8)(n.portal.url,o.url)&&parseInt(n.portal.currentVersion,10)>=2023){const{total:e}=await n.fetchResources();c=!!e}if(c){const t=await n.copy({copyResources:"all",folder:i});e.id=t.id,e.portal=t.portal;const r=e.toJSON();await e.load(),e.read(r),await e.update({data:a})}else await(o.user?.addItem({item:e,folder:i,data:a}));return c}(a,c,o,i);return t.portalItem=a,B(e,t,a,o,n),f}(e,t,i,c,l,o)&&(t.resourceReferences.portalItem=i),t.restoreThumbnailFromState(p),await Promise.all([t.updateItemThumbnail(),(0,b.r)(t.resourceReferences,l)]),i}function P(e,t){if(t.type!==e.itemType)throw new r.A(`${e.name}:portal-item-wrong-type`,`Portal item needs to have type "${e.itemType}"`)}async function S(e,t){if(!t.basemap?.baseLayers.length)throw new r.A(`${e.name}:save`,"Map does not have a valid basemap with a base layer.");let a=null;if(await(0,n.C_)((()=>{const e=(0,v.n8)(t.initialViewProperties,t.basemap);return a=e.spatialReference,!e.updating})),!(0,c.aI)(a,t.initialViewProperties.spatialReference))throw new r.A(`${e.name}:save`,"The spatial reference of the basemap is not compatible with the one from the map.",{expected:t.initialViewProperties.spatialReference,actual:a})}function M(e){const t=[];return e.basemap&&t.push(e.basemap.load()),e.ground&&t.push(e.ground.load()),Promise.allSettled(t).then((()=>{}))}async function W(e,t){t.extent=await async function(e,t){const r=t.clone().normalize();let o;if(r.length>1)for(const e of r)o?e.width>o.width&&(o=e):o=e;else o=r[0];return async function(e,t){const r=t.spatialReference;if(r.isWGS84)return t.clone();if(r.isWebMercator)return(0,p.ci)(t);const{getGeometryServiceURL:o}=await a.e(1426).then(a.bind(a,51426)),n=await o(e),s=new g.A;return s.geometries=[t],s.outSpatialReference=l.A.WGS84,(await(0,y.C)(n,s))[0]}(e,o)}(e.portalItem,e.initialViewProperties.viewpoint.targetGeometry),await async function(e,t){(0,h.LG)(t,L),await function(e){const t=N(e).map((e=>e.load())).toArray();return Promise.allSettled(t).then((()=>{}))}(e),function(e,t){(0,h.Y)(t,k)||(0,h.Y)(t,U)||(0,h.Y)(t,D)||(0,h.Y)(t,E)||!K(e)?(0,h.OM)(t,T):(0,h.LG)(t,T)}(e,t),function(e,t){K(e)?(0,h.LG)(t,C):(0,h.OM)(t,C)}(e,t),function(e,t){!(0,h.Y)(t,G)&&function(e){return N(e).filter((e=>"group"!==e.type)).every((t=>t.loaded&&function(e,t){return(0,d.W_)(t)&&t.capabilities.operations.supportsSync||function(e){return(0,d.Ov)(e)||"map-notes"===e.type||"route"===e.type}(t)&&!t.portalItem||("tile"===t.type||"vector-tile"===t.type)&&(t.capabilities.operations.supportsExportTiles||function(e){return"tile"===e.type&&(0,u.tK)(e.url)&&O.some((t=>e.url?.toLowerCase().includes("/"+t+"/")))}(t)||(0,v.JT)(t))&&t.spatialReference.equals(e.initialViewProperties.spatialReference)}(e,t)))}(e)?(0,h.LG)(t,$):(0,h.OM)(t,$)}(e,t),function(e,t){(0,v.Rc)(e.basemap)?(0,h.LG)(t,V):(0,h.OM)(t,V)}(e,t),function(e,t){e.utilityNetworks?.length?(0,h.LG)(t,j):(0,h.OM)(t,j)}(e,t),function(e,t){e.ipsInfo?(0,h.LG)(t,q):(0,h.OM)(t,q)}(e,t),t.typeKeywords&&(t.typeKeywords=t.typeKeywords.filter(((e,t,a)=>a.indexOf(e)===t)))}(e,t)}const L=h.mm.JSAPI,k="CollectorDisabled",T="Collector",C="Data Editing",G="OfflineDisabled",$="Offline",U="Workforce Project",D="Workforce Worker",E="Workforce Dispatcher",F="Offline Map Areas",x="FieldMapsDisabled",V=h.mm.DEVELOPER_BASEMAP,j="UtilityNetwork",q="IPS";function N(e){return e.allLayers.concat(e.allTables)}function K(e){return N(e).some((e=>e.loaded&&(0,d.W_)(e)&&e.capabilities.operations.supportsEditing&&e.editingEnabled&&("subtype-group"!==e.type||e.sublayers.some((e=>e.editingEnabled)))))}function B(e,t,a,r,n){o.L.prototype.read.call(t,{version:r.version,authoringApp:r.authoringApp,authoringAppVersion:r.authoringAppVersion},{origin:e.origin,ignoreDefaults:!0,url:a.itemUrl?(0,s.An)(a.itemUrl):void 0}),(0,i.v)(n),t.resourceInfo=r}}}]);